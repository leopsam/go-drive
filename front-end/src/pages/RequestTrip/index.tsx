import postRideEstimate from '../../services/postRideEstimateApi'
import { Container, Info } from './styles'
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import TripRequestForm from '../../components/TripRequestForm/index'
import Title from '../../components/TitleContainer/index'
import ButtonHistory from '../../components/ButtonHistory/index'

export default function Page() {
    const [customerId, setCustomerId] = useState('')
    const [origin, setOrigin] = useState('')
    const [destination, setDestination] = useState('')
    const [textButton, setTextButton] = useState('ESTIMAR VALOR DA VIAGEM')
    const navigate = useNavigate()

    function submitTripRequest(e: any) {
        e.preventDefault()
        setTextButton('Carregando...')

        postRideEstimate(customerId, origin, destination)
            .then(data => {
                localStorage.setItem('rideEstimateData', JSON.stringify(data))
                localStorage.setItem('rideEstimateBody', JSON.stringify({ customerId, origin, destination }))
                setTextButton('ESTIMAR VALOR DA VIAGEM')
                navigate('/confirm')
            })
            .catch((err: any) => {
                setTextButton('ESTIMAR VALOR DA VIAGEM')
                console.log(err)
            })
    }
    return (
        <Container>
            <Info>
                <Title>Bem vindo üöó</Title>
                <p>
                    No projeto Go Drive, voc√™ poder√° solicitar uma viagem em um carro particular de um ponto A at√© um ponto B. Ao fazer uma solicita√ß√£o, ser√°
                    necess√°rio informar o ID do usu√°rio, o endere√ßo de origem e o endere√ßo de destino para que possamos encontrar a melhor op√ß√£o para voc√™.
                </p>
                <p>
                    Al√©m disso, ap√≥s preencher essas informa√ß√µes, voc√™ poder√° escolher entre algumas op√ß√µes de motoristas dispon√≠veis e visualizar os
                    valorespara sua viagem. Depois de escolher a op√ß√£o ideal, voc√™ pode confirmar a sua solicita√ß√£o de viagem.
                </p>
                <p>
                    Em qualquer momento, tamb√©m ser√° poss√≠vel consultar o hist√≥rico das viagens realizadas, para que voc√™ tenha total controle sobre suas
                    viagens passadas.
                </p>
                <ButtonHistory onClick={() => navigate('/history')}>HIST√ìRICO DE VIAGENS</ButtonHistory>
            </Info>
            <TripRequestForm
                customerId={customerId}
                origin={origin}
                destination={destination}
                textButton={textButton}
                setCustomerId={setCustomerId}
                setOrigin={setOrigin}
                setDestination={setDestination}
                submitTripRequest={submitTripRequest}
            />
        </Container>
    )
}
